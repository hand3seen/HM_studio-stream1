<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Headmosh Neon Network — Fast Beat React</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- p5 + p5.sound -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/addons/p5.sound.min.js"></script>
  <style>
    html,body{margin:0;height:100%;background:#000;font-family:ui-sans-serif,system-ui,Inter,Roboto,Arial}
    .pump-link{
      position:fixed;left:18px;top:18px;z-index:9;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);
      border:1px solid rgba(255,255,255,.15);border-radius:12px;color:#e8f3ff;text-decoration:none;
      padding:10px 14px;font-size:14px;line-height:1;display:flex;gap:10px;align-items:center
    }
    .pump-dot{width:8px;height:8px;border-radius:50%;background:rgb(60,200,255);box-shadow:0 0 12px 4px rgba(60,200,255,.7)}
    .qr{display:none;position:absolute;left:0;top:44px;background:#000;border:1px solid rgba(255,255,255,.15);border-radius:8px;padding:8px}
    .pump-link:hover .qr{display:block}
    #mic-hint{position:fixed;right:18px;top:18px;color:#cde;z-index:9;font-size:12px;background:rgba(0,0,0,.5);
      padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.12)}
  </style>
</head>
<body>
  <!-- Edit URL/text as needed -->
  <a id="coinUrl" class="pump-link" target="_blank" rel="noreferrer">
    <span class="pump-dot"></span>
    <span id="coinText">pump.fun/coin/4QCQAkcKiYPnFWsSgGMuGeQdnrAmCKcNJkd2dm59pump</span>
    <img class="qr" id="qr" alt="QR" />
  </a>
  <div id="mic-hint">Press <b>M</b> to (re)enable mic/monitor for audio-reactivity</div>

<script>
/* ===== Headmosh Neon Network — FAST REACT =====
   Hotkeys:
   [M] mic on/off     [A] attract/repel
   [B] bloom          [N] palette
   [L] logo           [G] giveaway panel
   [K]/[J] sensitivity up/down
   [T] turbo sensitivity
   [H] toggle extra bass bias
   [S] snapshot       [R] reset particles
================================================ */

const CONFIG = {
  particleDensity: 0.12,
  maxSpeed: 1.5,
  connectRadius: 200,
  trailAlpha: 34,          // a bit lower for crisp strobe
  bloomPasses: 2,
  showLogo: true,
  showGiveaway: true,
  bannerTitle: "HEADMOSH STUDIO",
  bannerSub: "Go Head-First.",
  coinURL: "https://pump.fun/coin/4QCQAkcKiYPnFWsSgGMuGeQdnrAmCKcNJkd2dm59pump",
};

let particles = [];
let pg, t = 0;
let attract = true;
let bloom = true;
let palettes, paletteIndex = 0;

// Audio globals
let mic, fft, amp, peakLow;
let audioEnabled = false;
let energy = 0;              // enveloped display energy
let sensitivity = 1.35;
let extraBassBias = true;

// Ticker
let tickerMsg = "Headmosh — Fast React • Zine Lab • PumpFun link in title •";
let tickerX = 0;

// URL overrides
(function initParams(){
  const p = new URLSearchParams(location.search);
  if (p.get('title')) CONFIG.bannerTitle = p.get('title');
  if (p.get('sub')) CONFIG.bannerSub = p.get('sub');
  if (p.get('coin')) CONFIG.coinURL = p.get('coin');
})();

// Link + QR
const linkEl = document.getElementById('coinUrl');
const textEl = document.getElementById('coinText');
const qrEl = document.getElementById('qr');
textEl.textContent = CONFIG.coinURL.replace(/^https?:\/\//,'');
linkEl.href = CONFIG.coinURL;
qrEl.src = "https://api.qrserver.com/v1/create-qr-code/?size=120x120&data="+encodeURIComponent(CONFIG.coinURL);

// ---------------- Particles ----------------
class Particle {
  constructor(){
    this.x = random(width);
    this.y = random(height);
    this.vx = random(-CONFIG.maxSpeed, CONFIG.maxSpeed);
    this.vy = random(-CONFIG.maxSpeed, CONFIG.maxSpeed);
  }
  move(){
    const ang = noise(this.x*0.0012, this.y*0.0012, t*0.001) * TAU * (1.1 + energy*1.2);
    const push = (0.026 + energy*0.06 + energy*energy*0.12) * sensitivity; // strong punch on hits
    this.vx += Math.cos(ang) * push;
    this.vy += Math.sin(ang) * push;

    if (mouseX>=0 && mouseY>=0 && mouseX<=width && mouseY<=height){
      const dx = mouseX - this.x, dy = mouseY - this.y;
      const d2 = dx*dx + dy*dy;
      const force = constrain(42000/(d2+1400), 0, 0.22) * sensitivity;
      const s = attract ? 1 : -1;
      this.vx += s*dx*force*0.003;
      this.vy += s*dy*force*0.003;
    }

    const sp = Math.hypot(this.vx, this.vy);
    if (sp > CONFIG.maxSpeed){
      this.vx = (this.vx/sp)*CONFIG.maxSpeed;
      this.vy = (this.vy/sp)*CONFIG.maxSpeed;
    }

    this.x += this.vx;
    this.y += this.vy;

    if (this.x < -12) this.x = width+12;
    if (this.x > width+12) this.x = -12;
    if (this.y < -12) this.y = height+12;
    if (this.y > height+12) this.y = -12;
  }
  dot(g){
    g.noStroke();
    g.fill(255, 235);
    g.circle(this.x, this.y, 2.6 + energy*1.0);
  }
  connect(g, others){
    const cols = palettes[paletteIndex];
    for (let i=0;i<others.length;i++){
      const p = others[i];
      const dx = this.x - p.x, dy = this.y - p.y;
      const d = Math.hypot(dx, dy);
      if (d < CONFIG.connectRadius){
        const widthBoost = 1.0 + energy*2.2 + energy*energy*1.4;
        const w = map(d, 0, CONFIG.connectRadius, 2.6*widthBoost, 0.25);
        const a = map(d, 0, CONFIG.connectRadius, 240, 110);
        const c = cols[Math.floor(map(d,0,CONFIG.connectRadius,0,cols.length))%cols.length];

        g.stroke(c[0], c[1], c[2], a);
        g.strokeWeight(w);

        const j = 8*(1+energy*1.5);
        const mx = (this.x + p.x)/2 + Math.sin((this.x+t)*0.012)*j;
        const my = (this.y + p.y)/2 + Math.cos((this.y+t)*0.012)*j;
        g.noFill();
        g.beginShape();
        g.curveVertex(this.x, this.y);
        g.curveVertex(this.x, this.y);
        g.curveVertex(mx, my);
        g.curveVertex(p.x, p.y);
        g.curveVertex(p.x, p.y);
        g.endShape();
      }
    }
  }
}

// --------------- Setup/Draw ---------------
function setup(){
  pixelDensity(1);
  createCanvas(windowWidth, windowHeight);
  pg = createGraphics(width, height);

  palettes = [
    [ [10,240,255], [180,90,255], [255,80,180]]()
